From 1ad83fc2e80125a3c665547fc1a2db60e265afcd Mon Sep 17 00:00:00 2001
From: Tydus <noreply@example.com>
Date: Sat, 22 Feb 2020 01:38:12 +0900
Subject: [PATCH] rtmp: use args as name if no stream name specified

---
 ngx_rtmp_cmd_module.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/ngx_rtmp_cmd_module.c b/ngx_rtmp_cmd_module.c
index e7826aa..1ed8228 100644
--- a/ngx_rtmp_cmd_module.c
+++ b/ngx_rtmp_cmd_module.c
@@ -550,10 +550,12 @@ ngx_rtmp_cmd_publish_init(ngx_rtmp_session_t *s, ngx_rtmp_header_t *h,
     ngx_rtmp_cmd_fill_args(v.name, v.args);
 
     if (ngx_strlen(v.name) == 0) {
-        ngx_log_error(NGX_LOG_ERR, s->connection->log, 0,
-                      "publish: no stream name specified");
+        ngx_log_error(NGX_LOG_WARN, s->connection->log, 0,
+                      "publish: no stream name specified, s->app = %V, s->stream = %V, s->args = %V",
+                      &s->app, &s->stream, &s->args);
 
-        return NGX_ERROR;
+        //return NGX_ERROR;
+        ngx_memcpy(v.name, s->args.data, s->args.len > 16 ? 16 : s->args.len);
     }
 
     if (ngx_rtmp_process_request_line(s, v.name, v.args,
-- 
2.7.4

